---
- name: Run the Onyx container
  docker:
    name: onyx
    image: "{{ onyx_docker_image }}"
    net: host
    detach: yes
    state: reloaded
    restart_policy: always
    restart_policy_retry: 128
    privileged: yes
    env:
      NPEERS: "{{ onyx_n_peers }}"
      ONYX_ID: "{{ onyx_tenancy_id }}"
      BIND_ADDR: "{{ private_ip }}"
      PEER_JAVA_OPTS: "{{ peer_java_opts }}"
      ZOOKEEPER: "{{ play_hosts | join(',') }}"